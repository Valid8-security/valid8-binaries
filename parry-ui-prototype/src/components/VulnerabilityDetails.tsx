import React from 'react';
import { ArrowLeft, AlertTriangle, Code, ExternalLink, Calendar, User, Tag } from 'lucide-react';
import { Link } from 'react-router-dom';

const VulnerabilityDetails: React.FC = () => {
  const vulnerability = {
    id: 'VULN-2024-001',
    title: 'SQL Injection in User Authentication',
    severity: 'critical',
    cwe: 'CWE-89',
    cvss: 9.8,
    status: 'open',
    file: 'src/auth/userService.js',
    line: 45,
    discovered: '2024-01-15T10:30:00Z',
    assignee: 'security-team',
    tags: ['authentication', 'database', 'injection'],
    description: `A SQL injection vulnerability exists in the user authentication module. The application constructs SQL queries by directly concatenating user input without proper sanitization or parameterization. This allows attackers to inject malicious SQL code that can bypass authentication, extract sensitive data, or modify database contents.`,
    impact: `Successful exploitation could lead to:
• Unauthorized access to user accounts
• Exposure of sensitive user data
• Database manipulation or destruction
• Full system compromise`,
    reproduction: `1. Navigate to login page
2. Enter username: admin' OR '1'='1
3. Enter any password
4. Click login - authentication bypass occurs`,
    mitigation: `Implement parameterized queries or prepared statements:
\`\`\`javascript
// Instead of:
const query = \`SELECT * FROM users WHERE username = '\${username}'\`;

// Use:
const query = 'SELECT * FROM users WHERE username = ?';
const result = await db.query(query, [username]);
\`\`\``,
    references: [
      'https://owasp.org/www-community/attacks/SQL_Injection',
      'https://cwe.mitre.org/data/definitions/89.html',
      'https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html'
    ]
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical': return 'text-red-400 bg-red-500/20 border-red-500/30';
      case 'high': return 'text-orange-400 bg-orange-500/20 border-orange-500/30';
      case 'medium': return 'text-yellow-400 bg-yellow-500/20 border-yellow-500/30';
      case 'low': return 'text-green-400 bg-green-500/20 border-green-500/30';
      default: return 'text-gray-400 bg-gray-500/20 border-gray-500/30';
    }
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center space-x-4">
        <Link
          to="/"
          className="text-blue-300 hover:text-blue-100 transition-colors flex items-center space-x-2"
        >
          <ArrowLeft className="w-5 h-5" />
          <span>Back to Dashboard</span>
        </Link>
      </div>

      {/* Vulnerability Header */}
      <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
        <div className="flex items-start justify-between mb-4">
          <div className="flex-1">
            <div className="flex items-center space-x-3 mb-3">
              <AlertTriangle className="w-8 h-8 text-red-400" />
              <h1 className="text-2xl font-bold text-white">{vulnerability.title}</h1>
              <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getSeverityColor(vulnerability.severity)}`}>
                {vulnerability.severity.toUpperCase()}
              </span>
            </div>
            <div className="flex items-center space-x-6 text-blue-100">
              <span className="flex items-center space-x-2">
                <Tag className="w-4 h-4" />
                <span>{vulnerability.cwe}</span>
              </span>
              <span>CVSS: {vulnerability.cvss}</span>
              <span>ID: {vulnerability.id}</span>
            </div>
          </div>
          <div className="text-right">
            <div className="text-2xl font-bold text-white">{vulnerability.status}</div>
            <div className="text-blue-100 text-sm">Status</div>
          </div>
        </div>

        <div className="flex items-center space-x-6 text-sm text-blue-100">
          <span className="flex items-center space-x-2">
            <Code className="w-4 h-4" />
            <span>{vulnerability.file}:{vulnerability.line}</span>
          </span>
          <span className="flex items-center space-x-2">
            <Calendar className="w-4 h-4" />
            <span>Discovered {new Date(vulnerability.discovered).toLocaleDateString()}</span>
          </span>
          <span className="flex items-center space-x-2">
            <User className="w-4 h-4" />
            <span>Assigned to {vulnerability.assignee}</span>
          </span>
        </div>

        <div className="flex flex-wrap gap-2 mt-4">
          {vulnerability.tags.map((tag) => (
            <span
              key={tag}
              className="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-sm"
            >
              {tag}
            </span>
          ))}
        </div>
      </div>

      {/* Content Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Main Content */}
        <div className="lg:col-span-2 space-y-6">
          {/* Description */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h2 className="text-xl font-semibold text-white mb-4">Description</h2>
            <p className="text-blue-100 leading-relaxed">{vulnerability.description}</p>
          </div>

          {/* Impact */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h2 className="text-xl font-semibold text-white mb-4">Impact</h2>
            <div className="text-blue-100 leading-relaxed whitespace-pre-line">
              {vulnerability.impact}
            </div>
          </div>

          {/* Reproduction Steps */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h2 className="text-xl font-semibold text-white mb-4">Reproduction Steps</h2>
            <div className="bg-black/30 rounded-lg p-4 font-mono text-sm text-green-300">
              {vulnerability.reproduction}
            </div>
          </div>

          {/* Mitigation */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h2 className="text-xl font-semibold text-white mb-4">Mitigation</h2>
            <div className="text-blue-100 leading-relaxed mb-4">
              Implement parameterized queries or prepared statements:
            </div>
            <pre className="bg-black/30 rounded-lg p-4 overflow-x-auto">
              <code className="text-green-300 text-sm">
                {vulnerability.mitigation}
              </code>
            </pre>
          </div>
        </div>

        {/* Sidebar */}
        <div className="space-y-6">
          {/* Actions */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h3 className="text-lg font-semibold text-white mb-4">Actions</h3>
            <div className="space-y-3">
              <button className="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                Mark as Fixed
              </button>
              <button className="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                Assign to Developer
              </button>
              <button className="w-full bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700 transition-colors">
                Request Review
              </button>
              <button className="w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">
                Mark as False Positive
              </button>
            </div>
          </div>

          {/* References */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h3 className="text-lg font-semibold text-white mb-4">References</h3>
            <div className="space-y-2">
              {vulnerability.references.map((ref, index) => (
                <a
                  key={index}
                  href={ref}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center space-x-2 text-blue-300 hover:text-blue-100 transition-colors text-sm"
                >
                  <ExternalLink className="w-4 h-4" />
                  <span className="truncate">{ref}</span>
                </a>
              ))}
            </div>
          </div>

          {/* Related Vulnerabilities */}
          <div className="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 p-6">
            <h3 className="text-lg font-semibold text-white mb-4">Related Issues</h3>
            <div className="space-y-2">
              <div className="text-blue-100 text-sm">
                <div className="font-medium">VULN-2024-002</div>
                <div className="text-blue-200">Similar pattern in user profile update</div>
              </div>
              <div className="text-blue-100 text-sm">
                <div className="font-medium">VULN-2024-015</div>
                <div className="text-blue-200">Same CWE in admin panel</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default VulnerabilityDetails;
