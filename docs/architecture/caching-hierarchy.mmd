flowchart TD
    subgraph "L1: Memory Cache"
        L1_InMemory[(In-Memory LRU<br/>OrderedDict)]
        L1_Size[Max 500 entries<br/>~50MB limit]
        L1_Access[Sub-millisecond<br/>No I/O]
        L1_Evict[LRU Eviction<br/>Automatic cleanup]
    end

    subgraph "L2: File System Cache"
        L2_Persistent[(Persistent Files<br/>~/.parry/cache/)]
        L2_Size[Max 100MB<br/>Disk storage]
        L2_Access[Milliseconds<br/>File I/O]
        L2_TTL[TTL-based expiration<br/>1 hour default]
    end

    subgraph "Cache Keys"
        FileFingerprint[File Fingerprint<br/>SHA256 + mtime + size]
        PatternHash[Pattern Hash<br/>Regex + flags]
        AI_Response[AI Response Hash<br/>Prompt + model + temp]
        ValidationHash[Validation Hash<br/>Finding + context]
    end

    subgraph "Cache Statistics"
        HitRate[Hit Rate Tracking<br/>Performance monitoring]
        Compaction[Automatic Cleanup<br/>Size management]
        Invalidation[Smart Invalidation<br/>File changes detection]
    end

    L1_InMemory --> FileFingerprint
    L1_InMemory --> PatternHash
    L1_InMemory --> AI_Response
    L1_InMemory --> ValidationHash

    FileFingerprint --> L2_Persistent
    PatternHash --> L2_Persistent
    AI_Response --> L2_Persistent
    ValidationHash --> L2_Persistent

    L2_Persistent --> HitRate
    L1_InMemory --> Compaction
    L2_Persistent --> Invalidation

    style L1_InMemory fill:#e8f5e8
    style L2_Persistent fill:#fff3e0
    style FileFingerprint fill:#f3e5f5
    style HitRate fill:#e3f2fd
